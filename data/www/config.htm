<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="color-scheme" content="dark light">
<link rel="stylesheet" href="/styles.css">
<title>Configuration</title>
</head>
<body>
<h1>Configuration</h1>
<form id='config_form' action='#' method='POST'>
<table>
<tr><td>Spa Name:</td><td><input type='text' name='spaName' id='spaName'></td></tr>
<tr><td>MQTT Server:</td><td><input type='text' name='mqttServer' id='mqttServer'></td></tr>
<tr><td>MQTT Port:</td><td><input type='number' name='mqttPort' id='mqttPort'></td></tr>
<tr><td>MQTT Username:</td><td><input type='text' name='mqttUsername' id='mqttUsername'></td></tr>
<tr><td>MQTT Password:</td><td><input type='text' name='mqttPassword' id='mqttPassword'></td></tr>
<tr><td>Poll Frequency (seconds):</td><td><input type='number' name='updateFrequency' id='updateFrequency' step="1" min="10" max="300"></td></tr>
</table>
<input type='submit' value='Save'>
</form>
<div id='msg'></div>
<script src='https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script>
<script>
function loadConfig() {
  fetch('/json/config')
    .then(response => response.json())
    .then(data => {
      document.getElementById('spaName').value = data.spaName;
      document.getElementById('mqttServer').value = data.mqttServer;
      document.getElementById('mqttPort').value = data.mqttPort;
      document.getElementById('mqttUsername').value = data.mqttUsername;
      document.getElementById('mqttPassword').value = data.mqttPassword;
      document.getElementById('updateFrequency').value = data.updateFrequency;
    })
  .catch(error => console.error('Error loading config:', error));
}
document.addEventListener("DOMContentLoaded", loadConfig);
$('#config_form').submit(function(e) {
  e.preventDefault();
  $.ajax({
    url: '/config',
    type: 'POST',
    data: $('#config_form').serialize(),
    success: function() {
      $('#msg').html('<p style="color:green;">Configuration updated successfully!</p>');
      loadConfig();
      setTimeout(function() { $('#msg').html(''); }, 3000);
    },
    error: function() {
      $('#msg').html('<p style="color:red;">Error updating configuration.</p>');
    }
  });
});
</script>
</body>
</html>